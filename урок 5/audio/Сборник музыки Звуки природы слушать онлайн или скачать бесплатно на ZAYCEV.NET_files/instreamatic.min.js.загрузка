/* eslint-disable no-console */
/* eslint-disable no-sequences */
/* eslint-disable no-plusplus */

/* eslint-disable no-undef */
/* eslint-disable eqeqeq */
/* eslint-disable no-underscore-dangle */
/* eslint-disable no-void */
/* eslint-disable no-multi-assign */
/* eslint-disable no-unused-expressions */
/* eslint-disable camelcase */
/* eslint-disable no-var */
/*! zaycev 2022-01-13 15:41:16 | http://instreamatic.com */

const insertAfter = function (elem, refElem) {
	return refElem.parentNode.insertBefore(elem, refElem.nextSibling);
};
var xman = function (callback) {
	let xman_script, timeout;

	void 0 !== window.AdMan
		? callback(window.AdMan)
		: (((xman_script = document.createElement('script')).src =
				'//unisound.cdnvideo.ru/static/js/xman.min.js'),
		  (xman_script.onload = xman.onreadystatechange = function () {
				void 0 !== window.AdMan && callback(window.AdMan);
		  }),
		  (timeout = setInterval(function () {
				let d, w, id, ts, f, _s;

				typeof jQuery !== 'undefined' &&
					(document.documentElement.appendChild(xman_script),
					(window._tmr || (window._tmr = [])).push({
						id: '2847031',
						type: 'pageView',
						start: new Date().getTime()
					}),
					(d = document),
					(w = window),
					(id = 'topmailru-code'),
					d.getElementById(id) ||
						(((ts = d.createElement('script')).type = 'text/javascript'),
						(ts.async = !0),
						(ts.id = id),
						(ts.src =
							(d.location.protocol == 'https:' ? 'https:' : 'http:') +
							'//top-fwz1.mail.ru/js/code.js'),
						(f = function () {
							const s = d.getElementsByTagName('script')[0];

							s.parentNode.insertBefore(ts, s);
						}),
						w.opera == '[object Opera]'
							? d.addEventListener('DOMContentLoaded', f, !1)
							: f(),
						((_s = d.createElement('img')).src =
							'//top-fwz1.mail.ru/counter?id=2847031;js=na'),
						(_s.style = 'border:0;position:absolute;left:-9999px;'),
						insertAfter(_s, xman_script)),
					clearInterval(timeout));
		  })));
};

xman(function (AdMan) {
	window.onload = function () {
		function admanInit() {
			const overlays = [
				{
					id: 'info',
					target: $('div[data-qa="player-info"]'),
					mode: AdMan.Overlay.Mode.REPLACE,
					animate: AdMan.Overlay.Animate.BLUR,
					showOn: ['adStarted'],
					closeOn: ['adCompleted'],
					content: `<div class="instreamatic-player-overlay instreamatic-info">
								<div class="instreamatic-banner b128x128"></div>
								<div class="instreamatic-left"></div>
								<div class="instreamatic-link">Перейти на сайт рекламодателя</div>
							</div>`
				},
				{
					id: 'controls',
					target: $('button[data-qa="player-pause"]'),
					mode: AdMan.Overlay.Mode.REPLACE,
					animate: AdMan.Overlay.Animate.BLUR,
					showOn: ['adStarted'],
					closeOn: ['adCompleted'],
					content: `<div class="instreamatic-player-overlay instreamatic-controls">
								<div class="instreamatic-play">
									<svg width="27" height="32" viewBox="0 0 27 32" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M26.3108 16C26.3117 16.4179 26.2088 16.8289 26.0121 17.1931C25.8154 17.5573 25.5315 17.8623 25.188 18.0784L3.90349 31.6377C3.54464 31.8665 3.13363 31.9915 2.71292 31.9996C2.29221 32.0077 1.87705 31.8987 1.51031 31.6839C1.14706 31.4724 0.844464 31.1639 0.633639 30.7903C0.422814 30.4166 0.311367 29.9912 0.31076 29.5578V2.44219C0.311367 2.0088 0.422814 1.5834 0.633639 1.20974C0.844464 0.83608 1.14706 0.527639 1.51031 0.316137C1.87705 0.101299 2.29221 -0.00769122 2.71292 0.000422051C3.13363 0.00853532 3.54464 0.133458 3.90349 0.362289L25.188 13.9216C25.5315 14.1377 25.8154 14.4427 26.0121 14.8069C26.2088 15.1711 26.3117 15.5821 26.3108 16Z" />						
									</svg>
								</div>
								<div class="instreamatic-pause">
									<svg width="28" height="32" viewBox="0 0 28 32" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M4.81055 32C7.28555 32 9.31055 29.9429 9.31055 27.4286V4.57143C9.31055 2.05714 7.28555 0 4.81055 0C2.33555 0 0.310547 2.05714 0.310547 4.57143V27.4286C0.310547 29.9429 2.33555 32 4.81055 32ZM18.3105 4.57143V27.4286C18.3105 29.9429 20.3355 32 22.8105 32C25.2855 32 27.3105 29.9429 27.3105 27.4286V4.57143C27.3105 2.05714 25.2855 0 22.8105 0C20.3355 0 18.3105 2.05714 18.3105 4.57143Z" />
									</svg>
								</div>
							</div>`
				},
				{
					id: 'controls',
					target: $('button[data-qa="player-play"]'),
					mode: AdMan.Overlay.Mode.REPLACE,
					// animate: AdMan.Overlay.Animate.BLUR,
					showOn: ['adStarted'],
					closeOn: ['adCompleted'],
					content: `	<div class="instreamatic-player-overlay instreamatic-controls">
									<div class="instreamatic-play">
										<svg width="27" height="32" viewBox="0 0 27 32" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M26.3108 16C26.3117 16.4179 26.2088 16.8289 26.0121 17.1931C25.8154 17.5573 25.5315 17.8623 25.188 18.0784L3.90349 31.6377C3.54464 31.8665 3.13363 31.9915 2.71292 31.9996C2.29221 32.0077 1.87705 31.8987 1.51031 31.6839C1.14706 31.4724 0.844464 31.1639 0.633639 30.7903C0.422814 30.4166 0.311367 29.9912 0.31076 29.5578V2.44219C0.311367 2.0088 0.422814 1.5834 0.633639 1.20974C0.844464 0.83608 1.14706 0.527639 1.51031 0.316137C1.87705 0.101299 2.29221 -0.00769122 2.71292 0.000422051C3.13363 0.00853532 3.54464 0.133458 3.90349 0.362289L25.188 13.9216C25.5315 14.1377 25.8154 14.4427 26.0121 14.8069C26.2088 15.1711 26.3117 15.5821 26.3108 16Z" />						
										</svg>
									</div>
									<div class="instreamatic-pause">
										<svg width="28" height="32" viewBox="0 0 28 32" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M4.81055 32C7.28555 32 9.31055 29.9429 9.31055 27.4286V4.57143C9.31055 2.05714 7.28555 0 4.81055 0C2.33555 0 0.310547 2.05714 0.310547 4.57143V27.4286C0.310547 29.9429 2.33555 32 4.81055 32ZM18.3105 4.57143V27.4286C18.3105 29.9429 20.3355 32 22.8105 32C25.2855 32 27.3105 29.9429 27.3105 27.4286V4.57143C27.3105 2.05714 25.2855 0 22.8105 0C20.3355 0 18.3105 2.05714 18.3105 4.57143Z" />
										</svg>
									</div>
								</div>`
				},
				{
					id: 'volume',
					target: $('div[data-qa="player-volume"]'),
					mode: AdMan.Overlay.Mode.REPLACE,
					// animate: AdMan.Overlay.Animate.BLUR,
					showOn: ['adStarted'],
					closeOn: ['adCompleted'],
					content: `	<div class="instreamatic-player-overlay instreamatic-volume">
									<div class="instreamatic-mute">
										<svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg" style={{ marginRight: '2px' }}>
											<path
												d="M18.5 4.64282C18.5 4.64282 20 6.14282 20 8.64282C20 11.1428 18.5 12.6428 18.5 12.6428"
												strokeWidth="2"
												strokeLinecap="round"
												strokeLinejoin="round"
											/>
											<path
												d="M1 10.9998V7.28584C1 6.7554 1.21071 6.24669 1.58579 5.87162C1.96086 5.49655 2.46957 5.28584 3 5.28584H5.9C6.09552 5.28579 6.28674 5.22842 6.45 5.12084L12.45 1.16484C12.6008 1.06556 12.7756 1.00893 12.9559 1.00097C13.1362 0.993013 13.3154 1.03401 13.4743 1.11962C13.6332 1.20523 13.766 1.33226 13.8585 1.48723C13.9511 1.64219 14 1.81933 14 1.99984V16.2858C14 16.4663 13.9511 16.6435 13.8585 16.7984C13.766 16.9534 13.6332 17.0804 13.4743 17.166C13.3154 17.2517 13.1362 17.2927 12.9559 17.2847C12.7756 17.2767 12.6008 17.2201 12.45 17.1208L6.45 13.1648C6.28674 13.0572 6.09552 12.9999 5.9 12.9998H3C2.46957 12.9998 1.96086 12.7891 1.58579 12.414C1.21071 12.039 1 11.5303 1 10.9998Z"
												strokeWidth="2"
											/>
										</svg>
									</div>
									<div class="instreamatic-volume-back">
										<div class="instreamatic-volume-fore"></div>
									</div>
								</div>`
				},
				{
					id: 'banner',
					target: $('body'),
					mode: AdMan.Overlay.Mode.APPEND,
					animate: AdMan.Overlay.Animate.BLUR,
					showOn: ['adStarted'],
					closeOn: ['adCompleted'],
					showIf: [AdMan.Condition.banner()],
					content: `	<div class="instreamatic-banner-overlay instreamatic-fixed">
									<div class="instreamatic-banner ${isMobile.any ? 'b640x640' : 'b728x90'}">
										<div class="instreamatic-close" data-delay="5"></div>
									</div>
								</div>`
				}
			];

			AdMan.manager && AdMan.Manager.dispose(),
				new AdMan.Manager({
					admanId: 438,
					volume: document.audioPlayerForUni.getVolume(),
					overlay: overlays,
					events: {
						adStarted() {
							console.log('=== adStarted adv');
							document.audioPlayerForUni.pause();
						},
						adCompleted() {
							console.log('=== complete adv');
							document.audioPlayerForUni.play();
						},
						adNone() {
							console.log('=== none adv');
							document.cookie = 'adBox=; max-age=-1';
							document.audioPlayerForUni.play();
						}
					}
				}).start();
		}
		document.addEventListener('getNewTrack', function (event) {
			event.preventDefault();
			console.log('=== getNewTrack adv');
			admanInit();
		});
		document.addEventListener('toggleAdvPlayback', (event) => {
			if (AdMan) {
				event.preventDefault();
				if (AdMan.manager.engine.audio.audio.paused) {
					AdMan.manager.engine.play();
				} else {
					AdMan.manager.engine.pause();
				}
			}
		});
		document.addEventListener('playAdvPlayback', (event) => {
			if (AdMan) {
				event.preventDefault();
				AdMan.manager.engine.play();
			}
		});
	};
});
